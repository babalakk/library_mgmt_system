---
- name: Install and setup mysql server
  hosts: localhost
  roles:
      - { role: geerlingguy.mysql }

- name: Setup mysql utf8
  hosts: localhost
  tasks:
      - name: set [client] session configure
        lineinfile: dest=/etc/mysql/mysql.cnf insertafter="^\[client\]" line="default-character-set=utf8"

      - name: set [mysqld] session configure
        lineinfile: dest=/etc/mysql/mysql.cnf insertafter="^\[mysqld\]" line="collation-server = utf8_unicode_ci"

      - name: set [mysqld] session configure
        lineinfile: dest=/etc/mysql/mysql.cnf insertafter="^\[mysqld\]" line="init-connect='SET NAMES utf8'"

      - name: set [mysqld] session configure
        lineinfile: dest=/etc/mysql/mysql.cnf insertafter="^\[mysqld\]" line="character-set-server = utf8"

      - name: set [mysql] session configure
        lineinfile: dest=/etc/mysql/conf.d/mysql.cnf insertafter="^\[mysql\]" line="default-character-set=utf8"

      - name: restart mysql service
        service: name=mysql state=restarted
